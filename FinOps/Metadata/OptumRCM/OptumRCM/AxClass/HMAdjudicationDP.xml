<?xml version="1.0" encoding="utf-8"?>
<AxClass xmlns:i="http://www.w3.org/2001/XMLSchema-instance">
	<Name>HMAdjudicationDP</Name>
	<SourceCode>
		<Declaration><![CDATA[
[SrsReportQueryAttribute(querystr(HMAdjudicationQuery))]
class HMAdjudicationDP extends SRSReportDataProviderBase
{
    HMAdjudicationHeaderTmp     tmpTableHeader;
    HMAdjudicationLinesTmp      tmpTableLines;
    HMAdjudicationResponseTmp   tmpTableResponse;

}
]]></Declaration>
		<Methods>
			<Method>
				<Name>getTmpTableHeader</Name>
				<Source><![CDATA[
    [SRSReportDataSetAttribute (tablestr(HMAdjudicationHeaderTmp))]
    public HMAdjudicationHeaderTmp getTmpTableHeader()
    {
        select tmpTableHeader;
        return tmpTableHeader;
    }

]]></Source>
			</Method>
			<Method>
				<Name>getTmpTableLines</Name>
				<Source><![CDATA[
    [SRSReportDataSetAttribute (tablestr(HMAdjudicationLinesTmp))]
    public HMAdjudicationLinesTmp getTmpTableLines()
    {
        select tmpTableLines;
        return tmpTableLines;
    }

]]></Source>
			</Method>
			<Method>
				<Name>getTmpTableResponse</Name>
				<Source><![CDATA[
    [SRSReportDataSetAttribute (tablestr(HMAdjudicationResponseTmp))]
    public HMAdjudicationResponseTmp getTmpTableResponse()
    {
        select tmpTableResponse;
        return tmpTableResponse;
    }

]]></Source>
			</Method>
			<Method>
				<Name>processReport</Name>
				<Source><![CDATA[
    public void processReport()
    {
        Query                       query;
        QueryRun                    queryRun;
        DirPartyName                patientName;
        HMAdjudicationHeader        hmAdjudicationHeader;
        HMAdjudicationLines         hmAdjudicationLines;
        HMAdjudicationResponse      hmAdjudicationResponse;

        query = this.parmQuery();
        queryrun= new QueryRun(query);

        while (queryRun.next())
        {
            hmAdjudicationHeader        = queryrun.get(tableNum(HMAdjudicationHeader));
            patientName                 = this.getPatientName(hmAdjudicationHeader.InvoiceNumber);

            tmpTableHeader.PatientName              = patientName;
            tmpTableHeader.TransNum                 = hmAdjudicationHeader.TransNum;
            tmpTableHeader.InvoiceNumber            = hmAdjudicationHeader.InvoiceNumber;
            tmpTableHeader.Ins_Number               = hmAdjudicationHeader.Ins_Number;
            tmpTableHeader.HMInsurance              = hmAdjudicationHeader.HMInsurance;
            tmpTableHeader.PharmacyIdentifier       = hmAdjudicationHeader.PharmacyIdentifier;
            tmpTableHeader.PrescriptionNumber       = hmAdjudicationHeader.PrescriptionNumber;
            tmpTableHeader.DateFilledDOS            = hmAdjudicationHeader.DateFilledDOS;
            tmpTableHeader.DaysSupply               = hmAdjudicationHeader.DaysSupply;
            tmpTableHeader.Cost                     = hmAdjudicationHeader.Cost;
            tmpTableHeader.Reimbursement            = hmAdjudicationHeader.Reimbursement;
            tmpTableHeader.Profit                   = hmAdjudicationHeader.Profit;
            tmpTableHeader.Margin                   = hmAdjudicationHeader.Margin;
            tmpTableHeader.IngrCostBilled           = hmAdjudicationHeader.IngrCostBilled;
            tmpTableHeader.IngrCostPaid             = hmAdjudicationHeader.IngrCostPaid;
            tmpTableHeader.IngrCostDiscount         = hmAdjudicationHeader.IngrCostDiscount;
            tmpTableHeader.IngrCostDiscountPercent  = hmAdjudicationHeader.IngrCostDiscountPercent;
            tmpTableHeader.FeeBilled                = hmAdjudicationHeader.FeeBilled;
            tmpTableHeader.FeePaid                  = hmAdjudicationHeader.FeePaid;
            tmpTableHeader.FeeDiscount              = hmAdjudicationHeader.FeeDiscount;
            tmpTableHeader.FeeDiscountPercent       = hmAdjudicationHeader.FeeDiscountPercent;
            tmpTableHeader.TotalBilled              = hmAdjudicationHeader.TotalBilled;
            tmpTableHeader.TotalPaid                = hmAdjudicationHeader.TotalPaid;
            tmpTableHeader.TotalDiscount            = hmAdjudicationHeader.TotalDiscount;
            tmpTableHeader.TotalDiscountPercent     = hmAdjudicationHeader.TotalDiscountPercent;
            tmpTableHeader.ResponseReceivedDatetime = hmAdjudicationHeader.ResponseReceivedDatetime;
            tmpTableHeader.Type                     = hmAdjudicationHeader.Type;
            tmpTableHeader.Response                 = hmAdjudicationHeader.Response;
            tmpTableHeader.User                     = hmAdjudicationHeader.User;
            
            tmpTableHeader.insert();

            insert_recordset tmpTableLines(DrugName, NDC, QuantityMetric, Cpk_ncpdpmNum )
                select DrugName, NDC, QuantityMetric, Cpk_ncpdpmNum from hmAdjudicationLines
                    where hmAdjudicationLines.InvoiceNumber == hmAdjudicationHeader.InvoiceNumber
                        &&  hmAdjudicationLines.Ins_Number  ==  hmAdjudicationHeader.Ins_Number
                        &&  hmAdjudicationLines.Delflag ==  NoYes::No;

            insert_recordset tmpTableResponse(FieldDescription, ResponseData, IsCurrency, FieldName, cpk_Ncpdpreps)
                select FieldDescription, ResponseData, IsCurrency, FieldName, cpk_Ncpdpreps from hmAdjudicationResponse
                    where hmAdjudicationResponse.TransNum == hmAdjudicationHeader.TransNum;
        }
    }

]]></Source>
			</Method>
			<Method>
				<Name>getPatientName</Name>
				<Source><![CDATA[
    private DirPartyName getPatientName(HMCaseNo _CaseNo)
    {
        HMPatient   hmPatient;
        HMCase      hmCase;

        select hmPatient
            join hmCase
                where hmPatient.RecId == hmCase.HMPatient
                    && hmCase.CaseNo == _CaseNo;

        return hmPatient.patientName();
    }

]]></Source>
			</Method>
		</Methods>
	</SourceCode>
</AxClass>