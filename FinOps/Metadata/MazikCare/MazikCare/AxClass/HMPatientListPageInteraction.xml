<?xml version="1.0" encoding="utf-8"?>
<AxClass xmlns:i="http://www.w3.org/2001/XMLSchema-instance">
	<Name>HMPatientListPageInteraction</Name>
	<SourceCode>
		<Declaration><![CDATA[
class HMPatientListPageInteraction extends ListPageInteraction
{
}
]]></Declaration>
		<Methods>
			<Method>
				<Name>initializeQuery</Name>
				<Source><![CDATA[
    public void initializeQuery(Query _query)
    {
        if(this.listPage().listPageArgs().menuItemName() == menuitemDisplayStr(HMPatientListPageInactive))
        {
            _query.dataSourceTable(tableNum(HMPatient)).addRange(fieldNum(HMPatient,Status)).value(SysQuery::value(PatientStatus::InActive));
             this.listPage().actionPaneControlVisible(formControlStr(HMPatientListPage,HMPatientDeactivate),false);
             this.listPage().actionPaneControlVisible(formControlStr(HMPatientListPage,HMPatientActive),True);
             this.listPage().actionPaneControlVisible(formControlStr(HMPatientListPage,OpenSlotSearch),false);
             this.listPage().actionPaneControlVisible(formControlStr(HMPatientListPage,PatientAppointments),false);
             this.listPage().actionPaneControlVisible(formControlStr(HMPatientListPage,BillingPane),false);
             this.listPage().actionPaneControlVisible(formControlStr(HMPatientListPage,HMRegister),false);
             this.listPage().actionPaneControlVisible(formControlStr(HMPatientListPage,HMPatientEligibility),false);
    
    
        }
       else if(this.listPage().listPageArgs().menuItemName() == menuitemDisplayStr(HMUnregisteredPatientListPage))
        {
            _query.dataSourceTable(tableNum(HMPatient)).addRange(fieldNum(HMPatient,CustTable)).value(SysQuery::value(0));
            _query.dataSourceTable(tableNum(HMPatient)).addRange(fieldNum(HMPatient,Status)).value(SysQuery::value(PatientStatus::Active));
            this.listPage().actionPaneControlVisible(formControlStr(HMPatientListPage,HMPatientActive),false);
            this.listPage().actionPaneControlVisible(formControlStr(HMPatientListPage,HMPatientDeactivate),false);
            this.listPage().actionPaneControlVisible(formControlStr(HMPatientListPage,OpenSlotSearch),true);
            this.listPage().actionPaneControlVisible(formControlStr(HMPatientListPage,PatientAppointments),true);
            this.listPage().actionPaneControlVisible(formControlStr(HMPatientListPage,BillingPane),false);
    
    
        }
        else
        {
            _query.dataSourceTable(tableNum(HMPatient)).addRange(fieldNum(HMPatient,Status)).value(SysQuery::value(PatientStatus::Active));
            this.listPage().actionPaneControlVisible(formControlStr(HMPatientListPage,HMPatientActive),false);
            this.listPage().actionPaneControlVisible(formControlStr(HMPatientListPage,HMRegister),false);
        }
    
    /*Bupa doesn't need a category field on patient
        if(this.listPage().listPageArgs().enumTypeParameter())
        {
            _query.dataSourceTable(tableNum(HMPatient)).addRange(fieldNum(HMPatient,Category)).value(SysQuery::value(this.listPage().listPageArgs().enumTypeParameter()));
        }*/
    
        super(_query);
    }

]]></Source>
			</Method>
			<Method>
				<Name>selectionChanged</Name>
				<Source><![CDATA[
    public void selectionChanged()
    {
        HMPatient       hmPatient;
        CustTable       custTable;
        boolean         isProspect = true;
    
        super();
    
        hmPatient = this.listPage().activeRecord('HMPatient_1');
    
        custTable = this.listPage().activeRecord('CustTable_1');
    
        this.listPage().actionPaneControlEnabled(formControlStr(HMPatientListPage,HMPatientDeactivate), hmPatient.Status == PatientStatus::Active);
        this.listPage().actionPaneControlEnabled(formControlStr(HMPatientListPage,EditRecord), hmPatient.Status == PatientStatus::Active);
        //this.listPage().actionPaneControlEnabled(formControlStr(HMPatientListPage,HMPatientActive), hmPatient.Status != PatientStatus::Active);
    
        if (custTable)
        {
            this.listPage().actionPaneControlEnabled(formControlStr(HMPatientListPage,HMPatientDeactivate), hmPatient.Status == PatientStatus::Active);
            isProspect = false;
        }
        else
        {
            this.listPage().actionPaneControlEnabled(formControlStr(HMPatientListPage,HMPatientDeactivate), false);
        }
        this.listPage().actionPaneControlEnabled(formControlStr(HMPatientListPage, HMRegister), isProspect);
    
    }

]]></Source>
			</Method>
		</Methods>
	</SourceCode>
</AxClass>