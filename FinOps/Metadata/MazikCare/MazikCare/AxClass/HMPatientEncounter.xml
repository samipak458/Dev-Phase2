<?xml version="1.0" encoding="utf-8"?>
<AxClass xmlns:i="http://www.w3.org/2001/XMLSchema-instance">
	<Name>HMPatientEncounter</Name>
	<SourceCode>
		<Declaration><![CDATA[
class HMPatientEncounter
{
}
]]></Declaration>
		<Methods>
			<Method>
				<Name>getEncounterVitals</Name>
				<Source><![CDATA[
    public Map getEncounterVitals(str _caseId, RecId _appointmentRecId)
    {
        boolean ret;
        HMServiceAppHelper  appHelper = new HMServiceAppHelper();
        container conValues, recContainer;
        int recCount = 0, i =1;
        int enumVal;
        real realVal;
        int vitalSignId;
        str mapValue;
        Map recMap;
        Map retMap = new Map(Types::Integer, Types::String);
        HMToken     token = HMParameters::find().AuthorizationToken;
    
        try
        {
            ret = appHelper.callPostWebAPI('api/PatientEncounter/getLastRecordedVitals', "{'CaseId':'"+_caseId+"','AxAppoitnmentRefRecId':'"+int642str(_appointmentRecId)+"','currentPage' :'1'}", "Authorization: "+token+"");
    
            if(ret)
            {
                conValues = appHelper.parmRecordsCon();
    
                if(conValues != conNull())
                {
                    recCount = conPeek(conValues, 3);
    
                    if(recCount > 0)
                    {
                        for(i = 1;i <=recCount; i++)
                        {
                            recContainer = conPeek(conValues, i+3);
                            mapValue = "";
    
                            recMap = Map::create(recContainer);
    
                            vitalSignId = recMap.lookup('VitalValue');
                            realVal = recMap.lookup('MeasurementValue');
                            if(realVal > 0)
                            {
                                if(vitalSignId == 3)
                                {
                                    mapValue = num2Str(realVal,0,0,1,0);
                                }
                                else
                                {
                                    mapValue = num2Str(realVal,0,2,1,0);
                                }
    
                                realVal = recMap.lookup('MeasurementValue2');
    
                                if(realVal > 0)
                                {
                                    mapValue += "/" + num2Str(realVal,0,0,1,0);
                                }
                            }
                            else
                            {
                                mapValue = "0";
                            }
    
                            retMap.insert(vitalSignId, mapValue);
                        }
                    }
                }
            }
            else
            {
                if(appHelper.parmErrorMessage())
                {
                    error(appHelper.parmErrorMessage());
                }
    
                throw error("@MAZ13593");
            }
        }
        catch
        {
            retMap = null;
        }
    
        return retMap;
    }

]]></Source>
			</Method>
		</Methods>
	</SourceCode>
</AxClass>