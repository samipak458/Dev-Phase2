<?xml version="1.0" encoding="utf-8"?>
<AxClass xmlns:i="http://www.w3.org/2001/XMLSchema-instance">
	<Name>HMBillParameterEventHandler</Name>
	<SourceCode>
		<Declaration><![CDATA[
class HMBillParameterEventHandler
{
    
}
]]></Declaration>
		<Methods>
			<Method>
				<Name>HMBillParameters_InventJournalName_MovementPharmacy_OnLookup</Name>
				<Source><![CDATA[
    /// <summary>
    ///
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormControlEventHandler(formControlStr(HMBillProcCodeParam, HMBillParameters_InventJournalName_MovementPharmacy), FormControlEventType::Lookup)]
    public static void HMBillParameters_InventJournalName_MovementPharmacy_OnLookup(FormControl sender, FormControlEventArgs e)
    {
		Query					query = new Query();
		QueryBuildDataSource	qbdSource;
		SysTableLookup			sysTableLookup;
        HMParameters			patientPararmeters = HMParameters::find();
        CompanyInfo				pharmacyCompany;

      //  query.allowCrossCompany(true);

		sysTableLookup = SysTableLookup::newParameters(tableNum(InventJournalName),sender,true);

		sysTableLookup.parmUseLookupValue(false);
		sysTableLookup.addLookupfield(fieldNum(InventJournalName, JournalNameId));
		sysTableLookup.addLookupfield(fieldNum(InventJournalName, Description));

		qbdSource = query.addDataSource(tableNum(InventJournalName));
        qbdSource.addSortField(fieldnum(InventJournalName,JournalNameId));
        
        pharmacyCompany = CompanyInfo::findRecId(patientPararmeters.CompanyInfo_Pharmacy);

		if (pharmacyCompany)
        {
			qbdSource.Company(pharmacyCompany.DataArea);
        }

		qbdSource.addRange(fieldNum(InventJournalName, JournalType)).value(SysQuery::value(InventJournalType::Movement));
      //  qbdSource.addRange(fieldNum(InventJournalName, DataAreaId)).value(SysQuery::value('USMF'));
		sysTableLookup.parmQuery(query);
		sysTableLookup.performFormLookup();

		FormControlCancelableSuperEventArgs ce = e as FormControlCancelableSuperEventArgs;
		//cancel super() to prevent error.
		ce.CancelSuperCall();
        
    }

]]></Source>
			</Method>
		</Methods>
	</SourceCode>
</AxClass>