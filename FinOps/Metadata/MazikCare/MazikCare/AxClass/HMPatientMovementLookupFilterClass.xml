<?xml version="1.0" encoding="utf-8"?>
<AxClass xmlns:i="http://www.w3.org/2001/XMLSchema-instance">
	<Name>HMPatientMovementLookupFilterClass</Name>
	<SourceCode>
		<Declaration><![CDATA[
class HMPatientMovementLookupFilterClass
{
}
]]></Declaration>
		<Methods>
			<Method>
				<Name>filterBed</Name>
				<Source><![CDATA[
    public SysReferenceTableLookup filterBed(FormReferenceControl _formReferenceControl, recId  _recId)
    {
    
        SysReferenceTableLookup     sysReferenceTableLookup;
        QueryBuildDataSource        queryBuildDataSourceParent;
        QueryBuildDataSource        queryBuildDataSource;
        Query                       query = new Query();
    
        sysReferenceTableLookup = sysReferenceTableLookup::newParameters(tableNum(HMBuildingUnit), _formReferenceControl, true);
    
        queryBuildDataSourceParent = query.addDataSource(tableNum(HMBuildingUnit));
        queryBuildDataSource = queryBuildDataSourceParent.addDataSource(tableNum(HMBuildingUnitCategory));
        queryBuildDataSource.relations(true);
        queryBuildDataSource = queryBuildDataSource.addDataSource(tableNum(HMBuildingUnitType));
        queryBuildDataSource.relations(true);
        queryBuildDataSourceParent.addRange(fieldNum(HMBuildingUnit, HMBuildingUnit)).value(SysQuery::value(_recId));
        queryBuildDataSourceParent.addRange(fieldNum(HMBuildingUnit,IsBlocked)).value(SysQuery::value(NoYes::No));
        queryBuildDataSourceParent.addRange(fieldNum(HMBuildingUnit,FromDate)).value(strFmt('((FromDate <= %1) && (ToDate >= %1))',date2StrXpp(DateTimeUtil::getToday(DateTimeUtil::getUserPreferredTimeZone()))));
        queryBuildDataSource.addRange(fieldNum(HMBuildingUnitType, Indicators)).value(SysQuery::value(HMBuildingUnitTypeIndicator::BedLocation));
        queryBuildDataSource.addRange(fieldNum(HMBuildingUnitType, Indicators)).value(SysQuery::value(HMBuildingUnitTypeIndicator::RoomWithBedSupport));
    
        sysReferenceTableLookup.addLookupfield(fieldNum(HMBuildingUnit, Code));
        sysReferenceTableLookup.addLookupfield(fieldNum(HMBuildingUnit, Description));
        sysReferenceTableLookup.parmQuery(query);
    
        return sysReferenceTableLookup;
    }

]]></Source>
			</Method>
			<Method>
				<Name>filterDeptOU</Name>
				<Source><![CDATA[
    public SysReferenceTableLookup filterDeptOU(FormReferenceControl _formReferenceControl)
    {
    
        SysReferenceTableLookup sysReferenceTableLookup;
        QueryBuildDataSource    queryBuildDataSource, queryBuildDataSourceParent;
    
        Query   query           = new Query();
        sysReferenceTableLookup = SysReferenceTableLookup::newParameters(tableNum(HMOrganizationalUnit), _formReferenceControl, true);
    
        queryBuildDataSourceParent  = query.addDataSource(tableNum(HMOrganizationalUnit));
        queryBuildDataSource        = queryBuildDataSourceParent.addDataSource(tableNum(HMOrganizationaCategory));
        queryBuildDataSource.relations(true);
        queryBuildDataSourceParent.addRange(fieldNum(HMOrganizationalUnit, IsBlocked)).value(SysQuery::value(NoYes::No));
        queryBuildDataSource.addRange(fieldNum(HMOrganizationaCategory, Indicator)).value(SysQuery::value(HMOrganizationalCategoryIndicator::DepartmentalUnit));
    
        sysReferenceTableLookup.addLookupfield(fieldNum(HMOrganizationalUnit, Code));
        sysReferenceTableLookup.addLookupfield(fieldNum(HMOrganizationalUnit, Description));
        sysReferenceTableLookup.parmQuery(query);
    
        return  sysReferenceTableLookup;
    }

]]></Source>
			</Method>
			<Method>
				<Name>filterRoom</Name>
				<Source><![CDATA[
    public SysReferenceTableLookup filterRoom(FormReferenceControl _formReferenceControl, recId  _recId)
    {
    
        SysReferenceTableLookup sysReferenceTableLookup;
        QueryBuildDataSource    queryBuildDataSourceOrgBuilUnit;
        QueryBuildDataSource    queryBuildDataSourceBuildUnit;
        Query                   query = new Query();
    
         sysReferenceTableLookup = SysReferenceTableLookup::newParameters(tableNum(HMBuildingUnit), _formReferenceControl, true);   // passing  table whose look up is to open
       /* queryBuildDataSource = query.addDataSource(tableNum(HMBuildingUnit));
        queryBuildDataSource = queryBuildDataSource.addDataSource(tableNum(HMOrganizationalUnit));
        queryBuildDataSource.relations(true);
        queryBuildDataSource.addRange(fieldNum(HMOrganizationalUnit, recId)).value(SysQuery::value(_recId));
        sysReferenceTableLookup.addLookupfield(fieldNum(HMOrganizationalUnit, Code));
        sysReferenceTableLookup.addLookupfield(fieldNum(HMOrganizationalUnit, Description));
        sysReferenceTableLookup.parmQuery(query);
       */
    
        queryBuildDataSourceBuildUnit = query.addDataSource(tableNum(HMBuildingUnit));
        queryBuildDataSourceOrgBuilUnit = queryBuildDataSourceBuildUnit.addDataSource(tableNum(HMOrganizationalBuildingUnit));
        queryBuildDataSourceOrgBuilUnit.relations(true);
        queryBuildDataSourceOrgBuilUnit.addRange(fieldNum(HMOrganizationalBuildingUnit, HMOrganizationalUnit)).value(SysQuery::value(_recId));
        sysReferenceTableLookup.addLookupfield(fieldNum(HMBuildingUnit, Code));
        sysReferenceTableLookup.addLookupfield(fieldNum(HMBuildingUnit, Description));
        sysReferenceTableLookup.parmQuery(query);
    
        return sysReferenceTableLookup;
    
    }

]]></Source>
			</Method>
			<Method>
				<Name>filterTreatmentOU</Name>
				<Source><![CDATA[
    public SysReferenceTableLookup filterTreatmentOU(FormReferenceControl _formReferenceControl, recId  _recId, HMTransferType  _type)
    {
    
        SysReferenceTableLookup sysReferenceTableLookup;
        QueryBuildDataSource    queryBuildDataSourceParent;
        QueryBuildDataSource    queryBuildDataSource;
    
        Query   query           = new Query();
        sysReferenceTableLookup = SysReferenceTableLookup::newParameters(tableNum(HMOrganizationalUnit), _formReferenceControl, true);
    
        queryBuildDataSourceParent = query.addDataSource(tableNum(HMOrganizationalUnit));
        queryBuildDataSource = queryBuildDataSourceParent.addDataSource(tableNum(HMOrganizationaCategory));
        queryBuildDataSource.relations(true);
        queryBuildDataSourceParent.addRange(fieldNum(HMOrganizationalUnit, HMOrganizationalUnit)).value(SysQuery::value(_recId));
        queryBuildDataSourceParent.addRange(fieldNum(HMOrganizationalUnit, IsBlocked)).value(SysQuery::value(NoYes::No));
        queryBuildDataSourceParent.addRange(fieldNum(HMOrganizationalUnit,FromDate)).value(strFmt('((FromDate <= %1) && (ToDate >= %1))',date2StrXpp(DateTimeUtil::getToday(DateTimeUtil::getUserPreferredTimeZone()))));
    
        if (_type == HMTransferType::NursingUnit || _type == HMTransferType::DepartmentalAdmission)
        {
            queryBuildDataSource.addRange(fieldNum(HMOrganizationaCategory, Indicator)).value(SysQuery::value(HMOrganizationalCategoryIndicator::NursingAssignments));
        }
        else if (_type == HMTransferType::TreatmentUnit)
        {
            queryBuildDataSource.addRange(fieldNum(HMOrganizationaCategory, Indicator)).value(SysQuery::value(HMOrganizationalCategoryIndicator::TreatmentUnit));
        }
        else
        {
            queryBuildDataSource.addRange(fieldNum(HMOrganizationaCategory, Indicator)).value(SysQuery::value(HMOrganizationalCategoryIndicator::NursingAssignments));
            queryBuildDataSource.addRange(fieldNum(HMOrganizationaCategory, Indicator)).value(SysQuery::value(HMOrganizationalCategoryIndicator::TreatmentUnit));
        }
    
        sysReferenceTableLookup.addLookupfield(fieldNum(HMOrganizationalUnit, Code));
        sysReferenceTableLookup.addLookupfield(fieldNum(HMOrganizationalUnit, Description));
        sysReferenceTableLookup.parmQuery(query);
    
        return sysReferenceTableLookup;
    
    
    }

]]></Source>
			</Method>
		</Methods>
	</SourceCode>
</AxClass>