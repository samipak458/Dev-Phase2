<?xml version="1.0" encoding="utf-8"?>
<AxClass xmlns:i="http://www.w3.org/2001/XMLSchema-instance">
	<Name>HMPatientDeactivateClass</Name>
	<SourceCode>
		<Declaration><![CDATA[
class HMPatientDeactivateClass
{
}
]]></Declaration>
		<Methods>
			<Method>
				<Name>deactivatePatient</Name>
				<Source><![CDATA[
    public static void deactivatePatient(HMPatient _hmPatient, RecId _reasonRecId)
    {
        HMPatient                           hmPatientLocal;
        
        HMResourceSchedulingAppointment     HMResourceSchedulingAppointment;
        List                                apptRecIdList;
        hmPatientLocal = _hmPatient;
        try
        {
            ttsBegin;
            hmpatientlocal = hmpatient::find(hmPatientLocal.RecId,true);
            hmpatientlocal.status = patientstatus::inactive;
            hmpatientlocal.ReasonTablePatientDeactivate = _reasonRecId;
            hmpatientlocal.update();
            apptRecIdList = new List(Types::Int64);
            while select RecId from HMResourceSchedulingAppointment
                where HMResourceSchedulingAppointment.HMPatient == hmpatientlocal.RecId
                && HMResourceSchedulingAppointment.AppointmentStatus == HMResourceSchedulingAppointmentStatus::Confirmed
            {
                apptRecIdList.addEnd(HMResourceSchedulingAppointment.RecId);
            }
            if(apptRecIdList.elements()>0)
            {
                if(!HMResourceSchedulingHelper::cancelAppointment(apptRecIdList,HMAppointmentCancellationStatus::NoFeesOther,'',DateTimeUtil::getToday(DateTimeUtil::getUserPreferredTimeZone()),DateTimeUtil::getTimeNow(DateTimeUtil::getUserPreferredTimeZone()),0,dateNull()))
                {
                    error("@MAZ12288");
                    ttsAbort;
                }
            }
    
            ttsCommit;
        }
        catch
        {
            error("@MAZ12289");
            ttsAbort;
        }
    
    }

]]></Source>
			</Method>
		</Methods>
	</SourceCode>
</AxClass>