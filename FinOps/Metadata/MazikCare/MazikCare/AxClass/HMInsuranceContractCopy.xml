<?xml version="1.0" encoding="utf-8"?>
<AxClass xmlns:i="http://www.w3.org/2001/XMLSchema-instance">
	<Name>HMInsuranceContractCopy</Name>
	<SourceCode>
		<Declaration><![CDATA[
class HMInsuranceContractCopy
{
}
]]></Declaration>
		<Methods>
			<Method>
				<Name>main</Name>
				<Source><![CDATA[
    static void main (Args _args)
    {
        FormRun                                 callerForm;
        HMInsuranceContract                     callerContract, copyContract;
        HMInsuranceContractClassOrPlans         callerPlan, copyPlan;
        HMInsuranceContractClassDeductible      callerDeductible, copyDeductible;
        HMInsuranceContractClassTableOfBenefits callerTOB, copyTOB;
        HMContractName                          _name;
        HMContractNumber                        _number;
        HMContractEffectiveDate                 _strat ;
        HMContractEndDate                       _end;
        HmContractCopyObject HmContractCopyObject ;
    
        HmContractCopyObject=_args.parmObject();
        callerContract = _args.record();
        copyContract = HMInsuranceContract::CopyContract(callerContract,HmContractCopyObject);
        
        RecordInsertList copyPlanList, copyDeductibleList, copyTOBList;
        copyPlanList = new RecordInsertList(tableNum(HMInsuranceContractClassOrPlans));
        copyDeductibleList = new RecordInsertList(tableNum(HMInsuranceContractClassDeductible));
        copyTOBList =  new RecordInsertList(tableNum(HMInsuranceContractClassTableOfBenefits));

        ttsBegin;
    
        copyContract.insert();
    
        while select callerPlan
            where callerPlan.HMInsuranceContract == callerContract.RecId
        {
            copyPlan = HMInsuranceContractClassOrPlans::CopyPlan(callerPlan);
            copyPlan.HMInsuranceContract = copyContract.RecId;
            copyPlanList.add(copyPlan);
    
            while select callerDeductible
                where callerDeductible.HMInsuranceContractClassOrPlans == callerPlan.RecId
            {
                copyDeductible = HMInsuranceContractClassDeductible::copyDeductible(callerDeductible);
                copyDeductible.HMInsuranceContractClassOrPlans = copyPlan.RecId;
                copyDeductibleList.add(copyDeductible);
            }
            copyDeductibleList.insertDatabase();
    
            while select callerTOB
                where callerTOB.HMInsuranceContractClassOrPlans == callerPlan.RecId
            {
                copyTOB = HMInsuranceContractClassTableOfBenefits::copyTOB(callerTOB);
    
                copyTOB.HMInsuranceContractClassOrPlans = copyPlan.RecId;
                copyTOBList.add(copyTOB);
            }
            copyTOBList.insertDatabase();
        }
        copyPlanList.insertDatabase();
        ttsCommit;
    
        callerForm  = _args.caller();
    
        //callerForm.dataSource().research();
     }

]]></Source>
			</Method>
		</Methods>
	</SourceCode>
</AxClass>